<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ESP32通信控制</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .status { margin-bottom: 20px; padding: 10px; background-color: #f0f0f0; }
    .messages { height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; }
    input, button { padding: 5px; }
    .status-message { margin: 5px 0; }
    .esp32-message { color: blue; }
    .pc-message { color: green; }
  </style>
</head>
<body>
  <div class="status">
    <h3>连接状态</h3>
    <p id="connection-status">等待服务器启动...</p>
  </div>
  
  <div>
    <h3>消息记录</h3>
    <div class="messages" id="messages"></div>
  </div>
  
  <div>
    <input type="text" id="message-input" placeholder="输入要发送的消息 (如: LED_ON, LED_OFF, STATUS)">
    <button onclick="sendMessage()">发送</button>
    <p id="send-status"></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 获取DOM元素
      const statusElement = document.getElementById('connection-status');
      const messagesElement = document.getElementById('messages');
      const messageInput = document.getElementById('message-input');
      const sendButton = document.getElementById('send-button');
      const sendStatusElement = document.getElementById('send-status');
      
      // 监听连接状态变化
      window.electronAPI.onStatus((status) => {
        statusElement.textContent = status;
        appendMessage(`系统: ${status}`, 'status-message');
      });
      
      // 监听收到的消息
      window.electronAPI.onMessage((message) => {
        appendMessage(`ESP32: ${message.trim()}`, 'esp32-message');
      });
      
      // 监听发送状态
      window.electronAPI.onSendStatus((status) => {
        sendStatusElement.textContent = status;
        setTimeout(() => {
          sendStatusElement.textContent = '';
        }, 3000);
      });
      
      // 发送消息
      window.sendMessage = () => {
        const message = messageInput.value.trim();
        if (message) {
          window.electronAPI.sendMessage(message);
          appendMessage(`电脑: ${message}`, 'pc-message');
          messageInput.value = '';
        }
      };
      
      // 支持按Enter键发送
      messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          window.sendMessage();
        }
      });
      
      // 添加消息到消息区域
      function appendMessage(text, className) {
        const messageElement = document.createElement('p');
        messageElement.textContent = text;
        messageElement.className = className;
        messagesElement.appendChild(messageElement);
        messagesElement.scrollTop = messagesElement.scrollHeight;
      }
    });
  </script>
</body>
</html>